{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@/utils/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":63,"index":63}}],"key":"dzXjryHTvdSCDFGj8HDj8YCDHm4=","exportNames":["*"],"imports":1}},{"name":"./store","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":65},"end":{"line":2,"column":39,"index":104}}],"key":"5APpJpQn7z9vMHIr4H9Bv6aaMsY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  Object.defineProperty(exports, \"default\", {\n    enumerable: true,\n    get: function () {\n      return _default;\n    }\n  });\n  exports.signInWithCredentials = signInWithCredentials;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _utilsApi = require(_dependencyMap[1], \"@/utils/api\");\n  var _store = require(_dependencyMap[2], \"./store\");\n  // Programmatic credentials sign-in for mobile clients\n  // 1) POST to /api/auth/callback/credentials with form-encoded body\n  // 2) Fetch /api/auth/session to retrieve the session payload\n  // 3) Persist session in auth store (SecureStore)\n  /**\r\n   * @param {{ identifier?: string; email?: string; phone?: string; password: string; callbackUrl?: string }} params\r\n   */\n  function signInWithCredentials(_x) {\n    return _signInWithCredentials.apply(this, arguments);\n  }\n  function _signInWithCredentials() {\n    _signInWithCredentials = (0, _asyncToGenerator.default)(function* (_ref) {\n      var identifier = _ref.identifier,\n        email = _ref.email,\n        phone = _ref.phone,\n        password = _ref.password,\n        _ref$callbackUrl = _ref.callbackUrl,\n        callbackUrl = _ref$callbackUrl === void 0 ? '/' : _ref$callbackUrl;\n      try {\n        var loginIdentifier = identifier || email || phone;\n        if (!loginIdentifier) {\n          throw new Error('An email or phone number is required for sign in');\n        }\n        var body = new URLSearchParams();\n        body.set('identifier', loginIdentifier);\n        var trimmedEmail = (email ?? '').trim();\n        var trimmedPhone = (phone ?? '').trim();\n        if (trimmedEmail || loginIdentifier.includes('@')) {\n          body.set('email', trimmedEmail || loginIdentifier);\n        }\n        if (trimmedPhone || !loginIdentifier.includes('@')) {\n          body.set('phone', trimmedPhone || loginIdentifier);\n        }\n        body.set('password', password);\n        // Provide a callbackUrl so Auth.js has a target (even if we don't follow it here)\n        if (callbackUrl) body.set('callbackUrl', callbackUrl);\n        console.log('[signInWithCredentials] Attempting to sign in with identifier:', loginIdentifier);\n\n        // Auth.js may respond with a redirect; RN fetch will still apply Set-Cookie\n        var authResponse = yield (0, _utilsApi.apiFetch)('/api/auth/callback/credentials', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n          },\n          body: body.toString()\n        });\n        console.log('[signInWithCredentials] Auth callback response status:', authResponse.status);\n        console.log('[signInWithCredentials] Auth callback response URL:', authResponse.url);\n\n        // Log response headers to check if Set-Cookie was sent\n        var headers = {};\n        authResponse.headers.forEach((value, key) => {\n          headers[key] = value;\n        });\n        console.log('[signInWithCredentials] Response headers:', JSON.stringify(headers));\n\n        // Check if the response indicates an error\n        if (authResponse.status === 401 || authResponse.status === 403) {\n          console.log('[signInWithCredentials] Authentication failed - invalid credentials');\n          return {\n            ok: false,\n            error: 'Invalid credentials'\n          };\n        }\n\n        // Check if response contains an error parameter in URL (Auth.js error redirect)\n        var responseUrl = authResponse.url || '';\n        if (responseUrl.includes('error=')) {\n          var errorMatch = responseUrl.match(/error=([^&]+)/);\n          var errorType = errorMatch ? decodeURIComponent(errorMatch[1]) : 'CredentialsSignin';\n          console.log('[signInWithCredentials] Auth error detected:', errorType);\n          return {\n            ok: false,\n            error: 'Invalid credentials'\n          };\n        }\n\n        // Give the server a moment to set the session cookie\n        yield new Promise(resolve => setTimeout(resolve, 500));\n\n        // Now retrieve the session JSON\n        console.log('[signInWithCredentials] Fetching session...');\n        var session = yield (0, _utilsApi.apiFetchJson)('/api/auth/session', {\n          method: 'GET'\n        });\n        console.log('[signInWithCredentials] Session retrieved:', JSON.stringify(session));\n        if (session && (session.user || session?.expires)) {\n          // Store in auth store for app UI\n          _store.useAuthStore.getState().setAuth(session);\n          console.log('[signInWithCredentials] Sign in successful!');\n          return {\n            ok: true,\n            session\n          };\n        }\n        console.log('[signInWithCredentials] No valid session returned');\n        return {\n          ok: false,\n          error: 'No session returned'\n        };\n      } catch (error) {\n        console.error('[signInWithCredentials] Error during sign in:', error);\n        return {\n          ok: false,\n          error: error.message || 'Sign in failed'\n        };\n      }\n    });\n    return _signInWithCredentials.apply(this, arguments);\n  }\n  var _default = signInWithCredentials;\n});","lineCount":134,"map":[[12,2,88,0,"Object"],[12,8,88,0],[12,9,88,0,"defineProperty"],[12,23,88,0],[12,24,88,0,"exports"],[12,31,88,0],[13,4,88,0,"enumerable"],[13,14,88,0],[14,4,88,0,"get"],[14,7,88,0],[14,18,88,0,"get"],[14,19,88,0],[15,6,88,0],[15,13,88,0,"_default"],[15,21,88,0],[16,4,88,0],[17,2,88,0],[18,2,11,0,"exports"],[18,9,11,0],[18,10,11,0,"signInWithCredentials"],[18,31,11,0],[18,34,11,0,"signInWithCredentials"],[18,55,11,0],[19,2,86,1],[19,6,86,1,"_babelRuntimeHelpersAsyncToGenerator"],[19,42,86,1],[19,45,86,1,"require"],[19,52,86,1],[19,53,86,1,"_dependencyMap"],[19,67,86,1],[20,2,86,1],[20,6,86,1,"_asyncToGenerator"],[20,23,86,1],[20,26,86,1,"_interopDefault"],[20,41,86,1],[20,42,86,1,"_babelRuntimeHelpersAsyncToGenerator"],[20,78,86,1],[21,2,1,0],[21,6,1,0,"_utilsApi"],[21,15,1,0],[21,18,1,0,"require"],[21,25,1,0],[21,26,1,0,"_dependencyMap"],[21,40,1,0],[22,2,2,0],[22,6,2,0,"_store"],[22,12,2,0],[22,15,2,0,"require"],[22,22,2,0],[22,23,2,0,"_dependencyMap"],[22,37,2,0],[23,2,4,0],[24,2,5,0],[25,2,6,0],[26,2,7,0],[27,2,8,0],[28,0,9,0],[29,0,10,0],[30,2,8,0],[30,11,11,22,"signInWithCredentials"],[30,32,11,43,"signInWithCredentials"],[30,33,11,43,"_x"],[30,35,11,43],[31,4,11,43],[31,11,11,43,"_signInWithCredentials"],[31,33,11,43],[31,34,11,43,"apply"],[31,39,11,43],[31,46,11,43,"arguments"],[31,55,11,43],[32,2,11,43],[33,2,11,43],[33,11,11,43,"_signInWithCredentials"],[33,34,11,43],[34,4,11,43,"_signInWithCredentials"],[34,26,11,43],[34,33,11,43,"_asyncToGenerator"],[34,50,11,43],[34,51,11,43,"default"],[34,58,11,43],[34,60,11,7],[34,71,11,7,"_ref"],[34,75,11,7],[34,77,11,103],[35,6,11,103],[35,10,11,46,"identifier"],[35,20,11,56],[35,23,11,56,"_ref"],[35,27,11,56],[35,28,11,46,"identifier"],[35,38,11,56],[36,8,11,58,"email"],[36,13,11,63],[36,16,11,63,"_ref"],[36,20,11,63],[36,21,11,58,"email"],[36,26,11,63],[37,8,11,65,"phone"],[37,13,11,70],[37,16,11,70,"_ref"],[37,20,11,70],[37,21,11,65,"phone"],[37,26,11,70],[38,8,11,72,"password"],[38,16,11,80],[38,19,11,80,"_ref"],[38,23,11,80],[38,24,11,72,"password"],[38,32,11,80],[39,8,11,80,"_ref$callbackUrl"],[39,24,11,80],[39,27,11,80,"_ref"],[39,31,11,80],[39,32,11,82,"callbackUrl"],[39,43,11,93],[40,8,11,82,"callbackUrl"],[40,19,11,93],[40,22,11,93,"_ref$callbackUrl"],[40,38,11,93],[40,52,11,96],[40,55,11,99],[40,58,11,99,"_ref$callbackUrl"],[40,74,11,99],[41,6,12,2],[41,10,12,6],[42,8,13,4],[42,12,13,10,"loginIdentifier"],[42,27,13,25],[42,30,13,28,"identifier"],[42,40,13,38],[42,44,13,42,"email"],[42,49,13,47],[42,53,13,51,"phone"],[42,58,13,56],[43,8,14,4],[43,12,14,8],[43,13,14,9,"loginIdentifier"],[43,28,14,24],[43,30,14,26],[44,10,15,6],[44,16,15,12],[44,20,15,16,"Error"],[44,25,15,21],[44,26,15,22],[44,76,15,72],[44,77,15,73],[45,8,16,4],[46,8,17,4],[46,12,17,10,"body"],[46,16,17,14],[46,19,17,17],[46,23,17,21,"URLSearchParams"],[46,38,17,36],[46,39,17,37],[46,40,17,38],[47,8,18,4,"body"],[47,12,18,8],[47,13,18,9,"set"],[47,16,18,12],[47,17,18,13],[47,29,18,25],[47,31,18,27,"loginIdentifier"],[47,46,18,42],[47,47,18,43],[48,8,19,4],[48,12,19,10,"trimmedEmail"],[48,24,19,22],[48,27,19,25],[48,28,19,26,"email"],[48,33,19,31],[48,37,19,35],[48,39,19,37],[48,41,19,39,"trim"],[48,45,19,43],[48,46,19,44],[48,47,19,45],[49,8,20,4],[49,12,20,10,"trimmedPhone"],[49,24,20,22],[49,27,20,25],[49,28,20,26,"phone"],[49,33,20,31],[49,37,20,35],[49,39,20,37],[49,41,20,39,"trim"],[49,45,20,43],[49,46,20,44],[49,47,20,45],[50,8,21,4],[50,12,21,8,"trimmedEmail"],[50,24,21,20],[50,28,21,24,"loginIdentifier"],[50,43,21,39],[50,44,21,40,"includes"],[50,52,21,48],[50,53,21,49],[50,56,21,52],[50,57,21,53],[50,59,21,55],[51,10,22,6,"body"],[51,14,22,10],[51,15,22,11,"set"],[51,18,22,14],[51,19,22,15],[51,26,22,22],[51,28,22,24,"trimmedEmail"],[51,40,22,36],[51,44,22,40,"loginIdentifier"],[51,59,22,55],[51,60,22,56],[52,8,23,4],[53,8,24,4],[53,12,24,8,"trimmedPhone"],[53,24,24,20],[53,28,24,24],[53,29,24,25,"loginIdentifier"],[53,44,24,40],[53,45,24,41,"includes"],[53,53,24,49],[53,54,24,50],[53,57,24,53],[53,58,24,54],[53,60,24,56],[54,10,25,6,"body"],[54,14,25,10],[54,15,25,11,"set"],[54,18,25,14],[54,19,25,15],[54,26,25,22],[54,28,25,24,"trimmedPhone"],[54,40,25,36],[54,44,25,40,"loginIdentifier"],[54,59,25,55],[54,60,25,56],[55,8,26,4],[56,8,27,4,"body"],[56,12,27,8],[56,13,27,9,"set"],[56,16,27,12],[56,17,27,13],[56,27,27,23],[56,29,27,25,"password"],[56,37,27,33],[56,38,27,34],[57,8,28,4],[58,8,29,4],[58,12,29,8,"callbackUrl"],[58,23,29,19],[58,25,29,21,"body"],[58,29,29,25],[58,30,29,26,"set"],[58,33,29,29],[58,34,29,30],[58,47,29,43],[58,49,29,45,"callbackUrl"],[58,60,29,56],[58,61,29,57],[59,8,31,4,"console"],[59,15,31,11],[59,16,31,12,"log"],[59,19,31,15],[59,20,31,16],[59,84,31,80],[59,86,31,82,"loginIdentifier"],[59,101,31,97],[59,102,31,98],[61,8,33,4],[62,8,34,4],[62,12,34,10,"authResponse"],[62,24,34,22],[62,33,34,31],[62,37,34,31,"apiFetch"],[62,46,34,39],[62,47,34,39,"apiFetch"],[62,55,34,39],[62,57,34,40],[62,89,34,72],[62,91,34,74],[63,10,35,6,"method"],[63,16,35,12],[63,18,35,14],[63,24,35,20],[64,10,36,6,"headers"],[64,17,36,13],[64,19,36,15],[65,12,36,17],[65,26,36,31],[65,28,36,33],[66,10,36,69],[66,11,36,70],[67,10,37,6,"body"],[67,14,37,10],[67,16,37,12,"body"],[67,20,37,16],[67,21,37,17,"toString"],[67,29,37,25],[67,30,37,26],[68,8,38,4],[68,9,38,5],[68,10,38,6],[69,8,40,4,"console"],[69,15,40,11],[69,16,40,12,"log"],[69,19,40,15],[69,20,40,16],[69,76,40,72],[69,78,40,74,"authResponse"],[69,90,40,86],[69,91,40,87,"status"],[69,97,40,93],[69,98,40,94],[70,8,41,4,"console"],[70,15,41,11],[70,16,41,12,"log"],[70,19,41,15],[70,20,41,16],[70,73,41,69],[70,75,41,71,"authResponse"],[70,87,41,83],[70,88,41,84,"url"],[70,91,41,87],[70,92,41,88],[72,8,43,4],[73,8,44,4],[73,12,44,10,"headers"],[73,19,44,17],[73,22,44,20],[73,23,44,21],[73,24,44,22],[74,8,45,4,"authResponse"],[74,20,45,16],[74,21,45,17,"headers"],[74,28,45,24],[74,29,45,25,"forEach"],[74,36,45,32],[74,37,45,33],[74,38,45,34,"value"],[74,43,45,39],[74,45,45,41,"key"],[74,48,45,44],[74,53,45,49],[75,10,46,6,"headers"],[75,17,46,13],[75,18,46,14,"key"],[75,21,46,17],[75,22,46,18],[75,25,46,21,"value"],[75,30,46,26],[76,8,47,4],[76,9,47,5],[76,10,47,6],[77,8,48,4,"console"],[77,15,48,11],[77,16,48,12,"log"],[77,19,48,15],[77,20,48,16],[77,63,48,59],[77,65,48,61,"JSON"],[77,69,48,65],[77,70,48,66,"stringify"],[77,79,48,75],[77,80,48,76,"headers"],[77,87,48,83],[77,88,48,84],[77,89,48,85],[79,8,50,4],[80,8,51,4],[80,12,51,8,"authResponse"],[80,24,51,20],[80,25,51,21,"status"],[80,31,51,27],[80,36,51,32],[80,39,51,35],[80,43,51,39,"authResponse"],[80,55,51,51],[80,56,51,52,"status"],[80,62,51,58],[80,67,51,63],[80,70,51,66],[80,72,51,68],[81,10,52,2,"console"],[81,17,52,9],[81,18,52,10,"log"],[81,21,52,13],[81,22,52,14],[81,91,52,83],[81,92,52,84],[82,10,53,2],[82,17,53,9],[83,12,53,11,"ok"],[83,14,53,13],[83,16,53,15],[83,21,53,20],[84,12,53,22,"error"],[84,17,53,27],[84,19,53,29],[85,10,53,51],[85,11,53,52],[86,8,54,4],[88,8,56,4],[89,8,57,4],[89,12,57,10,"responseUrl"],[89,23,57,21],[89,26,57,24,"authResponse"],[89,38,57,36],[89,39,57,37,"url"],[89,42,57,40],[89,46,57,44],[89,48,57,46],[90,8,58,4],[90,12,58,8,"responseUrl"],[90,23,58,19],[90,24,58,20,"includes"],[90,32,58,28],[90,33,58,29],[90,41,58,37],[90,42,58,38],[90,44,58,40],[91,10,59,6],[91,14,59,12,"errorMatch"],[91,24,59,22],[91,27,59,25,"responseUrl"],[91,38,59,36],[91,39,59,37,"match"],[91,44,59,42],[91,45,59,43],[91,60,59,58],[91,61,59,59],[92,10,60,6],[92,14,60,12,"errorType"],[92,23,60,21],[92,26,60,24,"errorMatch"],[92,36,60,34],[92,39,60,37,"decodeURIComponent"],[92,57,60,55],[92,58,60,56,"errorMatch"],[92,68,60,66],[92,69,60,67],[92,70,60,68],[92,71,60,69],[92,72,60,70],[92,75,60,73],[92,94,60,92],[93,10,61,6,"console"],[93,17,61,13],[93,18,61,14,"log"],[93,21,61,17],[93,22,61,18],[93,68,61,64],[93,70,61,66,"errorType"],[93,79,61,75],[93,80,61,76],[94,10,62,2],[94,17,62,9],[95,12,62,11,"ok"],[95,14,62,13],[95,16,62,15],[95,21,62,20],[96,12,62,22,"error"],[96,17,62,27],[96,19,62,29],[97,10,62,51],[97,11,62,52],[98,8,63,4],[100,8,65,4],[101,8,66,4],[101,14,66,10],[101,18,66,14,"Promise"],[101,25,66,21],[101,26,66,22,"resolve"],[101,33,66,29],[101,37,66,33,"setTimeout"],[101,47,66,43],[101,48,66,44,"resolve"],[101,55,66,51],[101,57,66,53],[101,60,66,56],[101,61,66,57],[101,62,66,58],[103,8,68,4],[104,8,69,4,"console"],[104,15,69,11],[104,16,69,12,"log"],[104,19,69,15],[104,20,69,16],[104,65,69,61],[104,66,69,62],[105,8,70,4],[105,12,70,10,"session"],[105,19,70,17],[105,28,70,26],[105,32,70,26,"apiFetchJson"],[105,41,70,38],[105,42,70,38,"apiFetchJson"],[105,54,70,38],[105,56,70,39],[105,75,70,58],[105,77,70,60],[106,10,70,62,"method"],[106,16,70,68],[106,18,70,70],[107,8,70,76],[107,9,70,77],[107,10,70,78],[108,8,71,4,"console"],[108,15,71,11],[108,16,71,12,"log"],[108,19,71,15],[108,20,71,16],[108,64,71,60],[108,66,71,62,"JSON"],[108,70,71,66],[108,71,71,67,"stringify"],[108,80,71,76],[108,81,71,77,"session"],[108,88,71,84],[108,89,71,85],[108,90,71,86],[109,8,73,4],[109,12,73,8,"session"],[109,19,73,15],[109,24,73,20,"session"],[109,31,73,27],[109,32,73,28,"user"],[109,36,73,32],[109,40,73,36,"session"],[109,47,73,43],[109,49,73,45,"expires"],[109,56,73,52],[109,57,73,53],[109,59,73,55],[110,10,74,6],[111,10,75,6,"useAuthStore"],[111,16,75,18],[111,17,75,18,"useAuthStore"],[111,29,75,18],[111,30,75,19,"getState"],[111,38,75,27],[111,39,75,28],[111,40,75,29],[111,41,75,30,"setAuth"],[111,48,75,37],[111,49,75,38,"session"],[111,56,75,45],[111,57,75,46],[112,10,76,6,"console"],[112,17,76,13],[112,18,76,14,"log"],[112,21,76,17],[112,22,76,18],[112,67,76,63],[112,68,76,64],[113,10,77,6],[113,17,77,13],[114,12,77,15,"ok"],[114,14,77,17],[114,16,77,19],[114,20,77,23],[115,12,77,25,"session"],[116,10,77,33],[116,11,77,34],[117,8,78,4],[118,8,80,4,"console"],[118,15,80,11],[118,16,80,12,"log"],[118,19,80,15],[118,20,80,16],[118,71,80,67],[118,72,80,68],[119,8,81,4],[119,15,81,11],[120,10,81,13,"ok"],[120,12,81,15],[120,14,81,17],[120,19,81,22],[121,10,81,24,"error"],[121,15,81,29],[121,17,81,31],[122,8,81,53],[122,9,81,54],[123,6,82,2],[123,7,82,3],[123,8,82,4],[123,15,82,11,"error"],[123,20,82,16],[123,22,82,18],[124,8,83,4,"console"],[124,15,83,11],[124,16,83,12,"error"],[124,21,83,17],[124,22,83,18],[124,69,83,65],[124,71,83,67,"error"],[124,76,83,72],[124,77,83,73],[125,8,84,4],[125,15,84,11],[126,10,84,13,"ok"],[126,12,84,15],[126,14,84,17],[126,19,84,22],[127,10,84,24,"error"],[127,15,84,29],[127,17,84,31,"error"],[127,22,84,36],[127,23,84,37,"message"],[127,30,84,44],[127,34,84,48],[128,8,84,65],[128,9,84,66],[129,6,85,2],[130,4,86,0],[130,5,86,1],[131,4,86,1],[131,11,86,1,"_signInWithCredentials"],[131,33,86,1],[131,34,86,1,"apply"],[131,39,86,1],[131,46,86,1,"arguments"],[131,55,86,1],[132,2,86,1],[133,2,88,0],[133,6,88,0,"_default"],[133,14,88,0],[133,17,88,15,"signInWithCredentials"],[133,38,88,36],[134,0,88,37],[134,3]],"functionMap":{"names":["<global>","signInWithCredentials","authResponse.headers.forEach$argument_0","Promise$argument_0"],"mappings":"AAA;OCU;iCCkC;KDE;sBEmB,mCF;CDoB"},"hasCjsExports":false},"type":"js/module"}]}