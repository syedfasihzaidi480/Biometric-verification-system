{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"react-native","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":40,"index":40}}],"key":"KyzuX10g6ixS9UfynhmjlvCIG3g=","exportNames":["*"],"imports":1}},{"name":"@/utils/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":42},"end":{"line":2,"column":43,"index":85}}],"key":"dzXjryHTvdSCDFGj8HDj8YCDHm4=","exportNames":["*"],"imports":1}},{"name":"@/utils/auth/store","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":87},"end":{"line":3,"column":50,"index":137}}],"key":"VzDMA11jGiXP9AFTRgw0CVGaxUs=","exportNames":["*"],"imports":1}},{"name":"expo-constants","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":139},"end":{"line":4,"column":39,"index":178}}],"key":"pPv5KzfRT0rL6NCr7G9k0o4d1W8=","exportNames":["*"],"imports":1}},{"name":"expo-notifications","data":{"asyncType":"async","isESMImport":true,"locs":[{"start":{"line":16,"column":32,"index":530},"end":{"line":16,"column":60,"index":558}}],"key":"l0UNKVvUcBIvqlHD35QkqSvd8ug=","exportNames":["*"],"imports":1,"isOptional":true}},{"name":"expo/internal/async-require-module","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":16,"column":4,"index":502},"end":{"line":16,"column":60,"index":558}}],"key":"y8mhXL4zKvSVvgnacXXOn0UU+QQ=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.syncNotificationPreference = syncNotificationPreference;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _reactNative = require(_dependencyMap[1], \"react-native\");\n  var _utilsApi = require(_dependencyMap[2], \"@/utils/api\");\n  var _utilsAuthStore = require(_dependencyMap[3], \"@/utils/auth/store\");\n  var _expoConstants = require(_dependencyMap[4], \"expo-constants\");\n  var Constants = _interopDefault(_expoConstants);\n  // Check if running in Expo Go\n  var isExpoGo = Constants.default.appOwnership === 'expo';\n\n  // Lazy load expo-notifications to avoid Expo Go issues\n  var NotificationsModule = null;\n  var getNotifications = /*#__PURE__*/function () {\n    var _ref = (0, _asyncToGenerator.default)(function* () {\n      if (isExpoGo) return null;\n      if (NotificationsModule) return NotificationsModule;\n      try {\n        NotificationsModule = yield require(_dependencyMap[6], \"expo/internal/async-require-module\")(_dependencyMap[5], _dependencyMap.paths, \"expo-notifications\");\n        return NotificationsModule;\n      } catch (e) {\n        console.warn('[syncNotificationPreference] Could not load expo-notifications:', e.message);\n        return null;\n      }\n    });\n    return function getNotifications() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  // Best-effort sync; safe to call without awaiting in UI\n  function syncNotificationPreference(_x) {\n    return _syncNotificationPreference.apply(this, arguments);\n  }\n  function _syncNotificationPreference() {\n    _syncNotificationPreference = (0, _asyncToGenerator.default)(function* (enabled) {\n      try {\n        var token = null;\n        if (enabled) {\n          try {\n            // Only load and use notifications in development builds, not Expo Go\n            var Notifications = yield getNotifications();\n            if (Notifications) {\n              // On SDK 53+, projectId is auto-resolved when using EAS Updates. Fallback without.\n              var res = yield Notifications.getExpoPushTokenAsync();\n              token = res?.data || null;\n            }\n          } catch (e) {\n            // No token available (e.g., missing config or Expo Go); still sync enabled flag\n            console.warn('[syncNotificationPreference] Token fetch failed:', e.message);\n            token = null;\n          }\n        }\n        var auth = _utilsAuthStore.useAuthStore.getState().auth;\n        var userId = auth?.user?.id || auth?.user?.auth_user_id || null;\n        yield (0, _utilsApi.apiFetchJson)('/api/notifications/preferences', {\n          method: 'POST',\n          body: {\n            enabled: !!enabled,\n            token,\n            platform: _reactNative.Platform.OS,\n            userId\n          }\n        });\n      } catch (e) {\n        // Non-fatal; log and continue\n        console.warn('[syncNotificationPreference] Failed', e?.message);\n      }\n    });\n    return _syncNotificationPreference.apply(this, arguments);\n  }\n});","lineCount":83,"map":[[12,2,25,0,"exports"],[12,9,25,0],[12,10,25,0,"syncNotificationPreference"],[12,36,25,0],[12,39,25,0,"syncNotificationPreference"],[12,65,25,0],[13,2,60,1],[13,6,60,1,"_babelRuntimeHelpersAsyncToGenerator"],[13,42,60,1],[13,45,60,1,"require"],[13,52,60,1],[13,53,60,1,"_dependencyMap"],[13,67,60,1],[14,2,60,1],[14,6,60,1,"_asyncToGenerator"],[14,23,60,1],[14,26,60,1,"_interopDefault"],[14,41,60,1],[14,42,60,1,"_babelRuntimeHelpersAsyncToGenerator"],[14,78,60,1],[15,2,1,0],[15,6,1,0,"_reactNative"],[15,18,1,0],[15,21,1,0,"require"],[15,28,1,0],[15,29,1,0,"_dependencyMap"],[15,43,1,0],[16,2,2,0],[16,6,2,0,"_utilsApi"],[16,15,2,0],[16,18,2,0,"require"],[16,25,2,0],[16,26,2,0,"_dependencyMap"],[16,40,2,0],[17,2,3,0],[17,6,3,0,"_utilsAuthStore"],[17,21,3,0],[17,24,3,0,"require"],[17,31,3,0],[17,32,3,0,"_dependencyMap"],[17,46,3,0],[18,2,4,0],[18,6,4,0,"_expoConstants"],[18,20,4,0],[18,23,4,0,"require"],[18,30,4,0],[18,31,4,0,"_dependencyMap"],[18,45,4,0],[19,2,4,0],[19,6,4,0,"Constants"],[19,15,4,0],[19,18,4,0,"_interopDefault"],[19,33,4,0],[19,34,4,0,"_expoConstants"],[19,48,4,0],[20,2,6,0],[21,2,7,0],[21,6,7,6,"isExpoGo"],[21,14,7,14],[21,17,7,17,"Constants"],[21,26,7,26],[21,27,7,26,"default"],[21,34,7,26],[21,35,7,27,"appOwnership"],[21,47,7,39],[21,52,7,44],[21,58,7,50],[23,2,9,0],[24,2,10,0],[24,6,10,4,"NotificationsModule"],[24,25,10,23],[24,28,10,26],[24,32,10,30],[25,2,11,0],[25,6,11,6,"getNotifications"],[25,22,11,22],[26,4,11,22],[26,8,11,22,"_ref"],[26,12,11,22],[26,19,11,22,"_asyncToGenerator"],[26,36,11,22],[26,37,11,22,"default"],[26,44,11,22],[26,46,11,25],[26,59,11,37],[27,6,12,2],[27,10,12,6,"isExpoGo"],[27,18,12,14],[27,20,12,16],[27,27,12,23],[27,31,12,27],[28,6,13,2],[28,10,13,6,"NotificationsModule"],[28,29,13,25],[28,31,13,27],[28,38,13,34,"NotificationsModule"],[28,57,13,53],[29,6,15,2],[29,10,15,6],[30,8,16,4,"NotificationsModule"],[30,27,16,23],[30,36,16,23,"require"],[30,43,16,23],[30,44,16,23,"_dependencyMap"],[30,58,16,23],[30,101,16,23,"_dependencyMap"],[30,115,16,23],[30,120,16,23,"_dependencyMap"],[30,134,16,23],[30,135,16,23,"paths"],[30,140,16,23],[30,163,16,60],[31,8,17,4],[31,15,17,11,"NotificationsModule"],[31,34,17,30],[32,6,18,2],[32,7,18,3],[32,8,18,4],[32,15,18,11,"e"],[32,16,18,12],[32,18,18,14],[33,8,19,4,"console"],[33,15,19,11],[33,16,19,12,"warn"],[33,20,19,16],[33,21,19,17],[33,86,19,82],[33,88,19,84,"e"],[33,89,19,85],[33,90,19,86,"message"],[33,97,19,93],[33,98,19,94],[34,8,20,4],[34,15,20,11],[34,19,20,15],[35,6,21,2],[36,4,22,0],[36,5,22,1],[37,4,22,1],[37,20,11,6,"getNotifications"],[37,36,11,22,"getNotifications"],[37,37,11,22],[38,6,11,22],[38,13,11,22,"_ref"],[38,17,11,22],[38,18,11,22,"apply"],[38,23,11,22],[38,30,11,22,"arguments"],[38,39,11,22],[39,4,11,22],[40,2,11,22],[40,5,22,1],[42,2,24,0],[43,2,24,0],[43,11,25,22,"syncNotificationPreference"],[43,37,25,48,"syncNotificationPreference"],[43,38,25,48,"_x"],[43,40,25,48],[44,4,25,48],[44,11,25,48,"_syncNotificationPreference"],[44,38,25,48],[44,39,25,48,"apply"],[44,44,25,48],[44,51,25,48,"arguments"],[44,60,25,48],[45,2,25,48],[46,2,25,48],[46,11,25,48,"_syncNotificationPreference"],[46,39,25,48],[47,4,25,48,"_syncNotificationPreference"],[47,31,25,48],[47,38,25,48,"_asyncToGenerator"],[47,55,25,48],[47,56,25,48,"default"],[47,63,25,48],[47,65,25,7],[47,76,25,49,"enabled"],[47,83,25,56],[47,85,25,58],[48,6,26,2],[48,10,26,6],[49,8,27,4],[49,12,27,8,"token"],[49,17,27,13],[49,20,27,16],[49,24,27,20],[50,8,28,4],[50,12,28,8,"enabled"],[50,19,28,15],[50,21,28,17],[51,10,29,6],[51,14,29,10],[52,12,30,8],[53,12,31,8],[53,16,31,14,"Notifications"],[53,29,31,27],[53,38,31,36,"getNotifications"],[53,54,31,52],[53,55,31,53],[53,56,31,54],[54,12,32,8],[54,16,32,12,"Notifications"],[54,29,32,25],[54,31,32,27],[55,14,33,10],[56,14,34,10],[56,18,34,16,"res"],[56,21,34,19],[56,30,34,28,"Notifications"],[56,43,34,41],[56,44,34,42,"getExpoPushTokenAsync"],[56,65,34,63],[56,66,34,64],[56,67,34,65],[57,14,35,10,"token"],[57,19,35,15],[57,22,35,18,"res"],[57,25,35,21],[57,27,35,23,"data"],[57,31,35,27],[57,35,35,31],[57,39,35,35],[58,12,36,8],[59,10,37,6],[59,11,37,7],[59,12,37,8],[59,19,37,15,"e"],[59,20,37,16],[59,22,37,18],[60,12,38,8],[61,12,39,8,"console"],[61,19,39,15],[61,20,39,16,"warn"],[61,24,39,20],[61,25,39,21],[61,75,39,71],[61,77,39,73,"e"],[61,78,39,74],[61,79,39,75,"message"],[61,86,39,82],[61,87,39,83],[62,12,40,8,"token"],[62,17,40,13],[62,20,40,16],[62,24,40,20],[63,10,41,6],[64,8,42,4],[65,8,44,4],[65,12,44,10,"auth"],[65,16,44,14],[65,19,44,17,"useAuthStore"],[65,34,44,29],[65,35,44,29,"useAuthStore"],[65,47,44,29],[65,48,44,30,"getState"],[65,56,44,38],[65,57,44,39],[65,58,44,40],[65,59,44,41,"auth"],[65,63,44,45],[66,8,45,4],[66,12,45,10,"userId"],[66,18,45,16],[66,21,45,19,"auth"],[66,25,45,23],[66,27,45,25,"user"],[66,31,45,29],[66,33,45,31,"id"],[66,35,45,33],[66,39,45,37,"auth"],[66,43,45,41],[66,45,45,43,"user"],[66,49,45,47],[66,51,45,49,"auth_user_id"],[66,63,45,61],[66,67,45,65],[66,71,45,69],[67,8,47,4],[67,14,47,10],[67,18,47,10,"apiFetchJson"],[67,27,47,22],[67,28,47,22,"apiFetchJson"],[67,40,47,22],[67,42,47,23],[67,74,47,55],[67,76,47,57],[68,10,48,6,"method"],[68,16,48,12],[68,18,48,14],[68,24,48,20],[69,10,49,6,"body"],[69,14,49,10],[69,16,49,12],[70,12,50,8,"enabled"],[70,19,50,15],[70,21,50,17],[70,22,50,18],[70,23,50,19,"enabled"],[70,30,50,26],[71,12,51,8,"token"],[71,17,51,13],[72,12,52,8,"platform"],[72,20,52,16],[72,22,52,18,"Platform"],[72,34,52,26],[72,35,52,26,"Platform"],[72,43,52,26],[72,44,52,27,"OS"],[72,46,52,29],[73,12,53,8,"userId"],[74,10,54,6],[75,8,55,4],[75,9,55,5],[75,10,55,6],[76,6,56,2],[76,7,56,3],[76,8,56,4],[76,15,56,11,"e"],[76,16,56,12],[76,18,56,14],[77,8,57,4],[78,8,58,4,"console"],[78,15,58,11],[78,16,58,12,"warn"],[78,20,58,16],[78,21,58,17],[78,58,58,54],[78,60,58,56,"e"],[78,61,58,57],[78,63,58,59,"message"],[78,70,58,66],[78,71,58,67],[79,6,59,2],[80,4,60,0],[80,5,60,1],[81,4,60,1],[81,11,60,1,"_syncNotificationPreference"],[81,38,60,1],[81,39,60,1,"apply"],[81,44,60,1],[81,51,60,1,"arguments"],[81,60,60,1],[82,2,60,1],[83,0,60,1],[83,3]],"functionMap":{"names":["<global>","getNotifications","syncNotificationPreference"],"mappings":"AAA;yBCU;CDW;OEG;CFmC"},"hasCjsExports":false},"type":"js/module"}]}