{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"]}},{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"]}},{"name":"@/utils/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":63,"index":63}}],"key":"dzXjryHTvdSCDFGj8HDj8YCDHm4=","exportNames":["*"]}},{"name":"./store","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":65},"end":{"line":2,"column":39,"index":104}}],"key":"5APpJpQn7z9vMHIr4H9Bv6aaMsY=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.default = void 0;\n  exports.signInWithCredentials = signInWithCredentials;\n  var _asyncToGenerator2 = _interopRequireDefault(require(_dependencyMap[1], \"@babel/runtime/helpers/asyncToGenerator\"));\n  var _api = require(_dependencyMap[2], \"@/utils/api\");\n  var _store = require(_dependencyMap[3], \"./store\");\n  // Programmatic credentials sign-in for mobile clients\n  // 1) POST to /api/auth/callback/credentials with form-encoded body\n  // 2) Fetch /api/auth/session to retrieve the session payload\n  // 3) Persist session in auth store (SecureStore)\n  /**\r\n   * @param {{ identifier?: string; email?: string; phone?: string; password: string; callbackUrl?: string }} params\r\n   */\n  function signInWithCredentials(_x) {\n    return _signInWithCredentials.apply(this, arguments);\n  }\n  function _signInWithCredentials() {\n    _signInWithCredentials = (0, _asyncToGenerator2.default)(function* (_ref) {\n      var identifier = _ref.identifier,\n        email = _ref.email,\n        phone = _ref.phone,\n        password = _ref.password,\n        _ref$callbackUrl = _ref.callbackUrl,\n        callbackUrl = _ref$callbackUrl === void 0 ? '/' : _ref$callbackUrl;\n      try {\n        var loginIdentifier = identifier || email || phone;\n        if (!loginIdentifier) {\n          throw new Error('An email or phone number is required for sign in');\n        }\n        var body = new URLSearchParams();\n        body.set('identifier', loginIdentifier);\n        var trimmedEmail = (email ?? '').trim();\n        var trimmedPhone = (phone ?? '').trim();\n        if (trimmedEmail || loginIdentifier.includes('@')) {\n          body.set('email', trimmedEmail || loginIdentifier);\n        }\n        if (trimmedPhone || !loginIdentifier.includes('@')) {\n          body.set('phone', trimmedPhone || loginIdentifier);\n        }\n        body.set('password', password);\n        // Provide a callbackUrl so Auth.js has a target (even if we don't follow it here)\n        if (callbackUrl) body.set('callbackUrl', callbackUrl);\n        console.log('[signInWithCredentials] Attempting to sign in with identifier:', loginIdentifier);\n\n        // Auth.js may respond with a redirect; RN fetch will still apply Set-Cookie\n        var authResponse = yield (0, _api.apiFetch)('/api/auth/callback/credentials', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n          },\n          body: body.toString()\n        });\n        console.log('[signInWithCredentials] Auth callback response status:', authResponse.status);\n        console.log('[signInWithCredentials] Auth callback response URL:', authResponse.url);\n\n        // Log response headers to check if Set-Cookie was sent\n        var headers = {};\n        authResponse.headers.forEach((value, key) => {\n          headers[key] = value;\n        });\n        console.log('[signInWithCredentials] Response headers:', JSON.stringify(headers));\n\n        // Check if the response indicates an error\n        if (authResponse.status === 401 || authResponse.status === 403) {\n          console.log('[signInWithCredentials] Authentication failed - invalid credentials');\n          return {\n            ok: false,\n            error: 'Invalid credentials'\n          };\n        }\n\n        // Check if response contains an error parameter in URL (Auth.js error redirect)\n        var responseUrl = authResponse.url || '';\n        if (responseUrl.includes('error=')) {\n          var errorMatch = responseUrl.match(/error=([^&]+)/);\n          var errorType = errorMatch ? decodeURIComponent(errorMatch[1]) : 'CredentialsSignin';\n          console.log('[signInWithCredentials] Auth error detected:', errorType);\n          return {\n            ok: false,\n            error: 'Invalid credentials'\n          };\n        }\n\n        // Give the server a moment to set the session cookie\n        yield new Promise(resolve => setTimeout(resolve, 500));\n\n        // Now retrieve the session JSON\n        console.log('[signInWithCredentials] Fetching session...');\n        var session = yield (0, _api.apiFetchJson)('/api/auth/session', {\n          method: 'GET'\n        });\n        console.log('[signInWithCredentials] Session retrieved:', JSON.stringify(session));\n        if (session && (session.user || session?.expires)) {\n          // Store in auth store for app UI\n          _store.useAuthStore.getState().setAuth(session);\n          console.log('[signInWithCredentials] Sign in successful!');\n          return {\n            ok: true,\n            session\n          };\n        }\n        console.log('[signInWithCredentials] No valid session returned');\n        return {\n          ok: false,\n          error: 'No session returned'\n        };\n      } catch (error) {\n        console.error('[signInWithCredentials] Error during sign in:', error);\n        return {\n          ok: false,\n          error: error.message || 'Sign in failed'\n        };\n      }\n    });\n    return _signInWithCredentials.apply(this, arguments);\n  }\n  var _default = exports.default = signInWithCredentials;\n});","lineCount":122,"map":[[9,2,1,0],[9,6,1,0,"_api"],[9,10,1,0],[9,13,1,0,"require"],[9,20,1,0],[9,21,1,0,"_dependencyMap"],[9,35,1,0],[10,2,2,0],[10,6,2,0,"_store"],[10,12,2,0],[10,15,2,0,"require"],[10,22,2,0],[10,23,2,0,"_dependencyMap"],[10,37,2,0],[11,2,4,0],[12,2,5,0],[13,2,6,0],[14,2,7,0],[15,2,8,0],[16,0,9,0],[17,0,10,0],[18,2,8,0],[18,11,11,22,"signInWithCredentials"],[18,32,11,43,"signInWithCredentials"],[18,33,11,43,"_x"],[18,35,11,43],[19,4,11,43],[19,11,11,43,"_signInWithCredentials"],[19,33,11,43],[19,34,11,43,"apply"],[19,39,11,43],[19,46,11,43,"arguments"],[19,55,11,43],[20,2,11,43],[21,2,11,43],[21,11,11,43,"_signInWithCredentials"],[21,34,11,43],[22,4,11,43,"_signInWithCredentials"],[22,26,11,43],[22,33,11,43,"_asyncToGenerator2"],[22,51,11,43],[22,52,11,43,"default"],[22,59,11,43],[22,61,11,7],[22,72,11,7,"_ref"],[22,76,11,7],[22,78,11,103],[23,6,11,103],[23,10,11,46,"identifier"],[23,20,11,56],[23,23,11,56,"_ref"],[23,27,11,56],[23,28,11,46,"identifier"],[23,38,11,56],[24,8,11,58,"email"],[24,13,11,63],[24,16,11,63,"_ref"],[24,20,11,63],[24,21,11,58,"email"],[24,26,11,63],[25,8,11,65,"phone"],[25,13,11,70],[25,16,11,70,"_ref"],[25,20,11,70],[25,21,11,65,"phone"],[25,26,11,70],[26,8,11,72,"password"],[26,16,11,80],[26,19,11,80,"_ref"],[26,23,11,80],[26,24,11,72,"password"],[26,32,11,80],[27,8,11,80,"_ref$callbackUrl"],[27,24,11,80],[27,27,11,80,"_ref"],[27,31,11,80],[27,32,11,82,"callbackUrl"],[27,43,11,93],[28,8,11,82,"callbackUrl"],[28,19,11,93],[28,22,11,93,"_ref$callbackUrl"],[28,38,11,93],[28,52,11,96],[28,55,11,99],[28,58,11,99,"_ref$callbackUrl"],[28,74,11,99],[29,6,12,2],[29,10,12,6],[30,8,13,4],[30,12,13,10,"loginIdentifier"],[30,27,13,25],[30,30,13,28,"identifier"],[30,40,13,38],[30,44,13,42,"email"],[30,49,13,47],[30,53,13,51,"phone"],[30,58,13,56],[31,8,14,4],[31,12,14,8],[31,13,14,9,"loginIdentifier"],[31,28,14,24],[31,30,14,26],[32,10,15,6],[32,16,15,12],[32,20,15,16,"Error"],[32,25,15,21],[32,26,15,22],[32,76,15,72],[32,77,15,73],[33,8,16,4],[34,8,17,4],[34,12,17,10,"body"],[34,16,17,14],[34,19,17,17],[34,23,17,21,"URLSearchParams"],[34,38,17,36],[34,39,17,37],[34,40,17,38],[35,8,18,4,"body"],[35,12,18,8],[35,13,18,9,"set"],[35,16,18,12],[35,17,18,13],[35,29,18,25],[35,31,18,27,"loginIdentifier"],[35,46,18,42],[35,47,18,43],[36,8,19,4],[36,12,19,10,"trimmedEmail"],[36,24,19,22],[36,27,19,25],[36,28,19,26,"email"],[36,33,19,31],[36,37,19,35],[36,39,19,37],[36,41,19,39,"trim"],[36,45,19,43],[36,46,19,44],[36,47,19,45],[37,8,20,4],[37,12,20,10,"trimmedPhone"],[37,24,20,22],[37,27,20,25],[37,28,20,26,"phone"],[37,33,20,31],[37,37,20,35],[37,39,20,37],[37,41,20,39,"trim"],[37,45,20,43],[37,46,20,44],[37,47,20,45],[38,8,21,4],[38,12,21,8,"trimmedEmail"],[38,24,21,20],[38,28,21,24,"loginIdentifier"],[38,43,21,39],[38,44,21,40,"includes"],[38,52,21,48],[38,53,21,49],[38,56,21,52],[38,57,21,53],[38,59,21,55],[39,10,22,6,"body"],[39,14,22,10],[39,15,22,11,"set"],[39,18,22,14],[39,19,22,15],[39,26,22,22],[39,28,22,24,"trimmedEmail"],[39,40,22,36],[39,44,22,40,"loginIdentifier"],[39,59,22,55],[39,60,22,56],[40,8,23,4],[41,8,24,4],[41,12,24,8,"trimmedPhone"],[41,24,24,20],[41,28,24,24],[41,29,24,25,"loginIdentifier"],[41,44,24,40],[41,45,24,41,"includes"],[41,53,24,49],[41,54,24,50],[41,57,24,53],[41,58,24,54],[41,60,24,56],[42,10,25,6,"body"],[42,14,25,10],[42,15,25,11,"set"],[42,18,25,14],[42,19,25,15],[42,26,25,22],[42,28,25,24,"trimmedPhone"],[42,40,25,36],[42,44,25,40,"loginIdentifier"],[42,59,25,55],[42,60,25,56],[43,8,26,4],[44,8,27,4,"body"],[44,12,27,8],[44,13,27,9,"set"],[44,16,27,12],[44,17,27,13],[44,27,27,23],[44,29,27,25,"password"],[44,37,27,33],[44,38,27,34],[45,8,28,4],[46,8,29,4],[46,12,29,8,"callbackUrl"],[46,23,29,19],[46,25,29,21,"body"],[46,29,29,25],[46,30,29,26,"set"],[46,33,29,29],[46,34,29,30],[46,47,29,43],[46,49,29,45,"callbackUrl"],[46,60,29,56],[46,61,29,57],[47,8,31,4,"console"],[47,15,31,11],[47,16,31,12,"log"],[47,19,31,15],[47,20,31,16],[47,84,31,80],[47,86,31,82,"loginIdentifier"],[47,101,31,97],[47,102,31,98],[49,8,33,4],[50,8,34,4],[50,12,34,10,"authResponse"],[50,24,34,22],[50,33,34,31],[50,37,34,31,"apiFetch"],[50,50,34,39],[50,52,34,40],[50,84,34,72],[50,86,34,74],[51,10,35,6,"method"],[51,16,35,12],[51,18,35,14],[51,24,35,20],[52,10,36,6,"headers"],[52,17,36,13],[52,19,36,15],[53,12,36,17],[53,26,36,31],[53,28,36,33],[54,10,36,69],[54,11,36,70],[55,10,37,6,"body"],[55,14,37,10],[55,16,37,12,"body"],[55,20,37,16],[55,21,37,17,"toString"],[55,29,37,25],[55,30,37,26],[56,8,38,4],[56,9,38,5],[56,10,38,6],[57,8,40,4,"console"],[57,15,40,11],[57,16,40,12,"log"],[57,19,40,15],[57,20,40,16],[57,76,40,72],[57,78,40,74,"authResponse"],[57,90,40,86],[57,91,40,87,"status"],[57,97,40,93],[57,98,40,94],[58,8,41,4,"console"],[58,15,41,11],[58,16,41,12,"log"],[58,19,41,15],[58,20,41,16],[58,73,41,69],[58,75,41,71,"authResponse"],[58,87,41,83],[58,88,41,84,"url"],[58,91,41,87],[58,92,41,88],[60,8,43,4],[61,8,44,4],[61,12,44,10,"headers"],[61,19,44,17],[61,22,44,20],[61,23,44,21],[61,24,44,22],[62,8,45,4,"authResponse"],[62,20,45,16],[62,21,45,17,"headers"],[62,28,45,24],[62,29,45,25,"forEach"],[62,36,45,32],[62,37,45,33],[62,38,45,34,"value"],[62,43,45,39],[62,45,45,41,"key"],[62,48,45,44],[62,53,45,49],[63,10,46,6,"headers"],[63,17,46,13],[63,18,46,14,"key"],[63,21,46,17],[63,22,46,18],[63,25,46,21,"value"],[63,30,46,26],[64,8,47,4],[64,9,47,5],[64,10,47,6],[65,8,48,4,"console"],[65,15,48,11],[65,16,48,12,"log"],[65,19,48,15],[65,20,48,16],[65,63,48,59],[65,65,48,61,"JSON"],[65,69,48,65],[65,70,48,66,"stringify"],[65,79,48,75],[65,80,48,76,"headers"],[65,87,48,83],[65,88,48,84],[65,89,48,85],[67,8,50,4],[68,8,51,4],[68,12,51,8,"authResponse"],[68,24,51,20],[68,25,51,21,"status"],[68,31,51,27],[68,36,51,32],[68,39,51,35],[68,43,51,39,"authResponse"],[68,55,51,51],[68,56,51,52,"status"],[68,62,51,58],[68,67,51,63],[68,70,51,66],[68,72,51,68],[69,10,52,2,"console"],[69,17,52,9],[69,18,52,10,"log"],[69,21,52,13],[69,22,52,14],[69,91,52,83],[69,92,52,84],[70,10,53,2],[70,17,53,9],[71,12,53,11,"ok"],[71,14,53,13],[71,16,53,15],[71,21,53,20],[72,12,53,22,"error"],[72,17,53,27],[72,19,53,29],[73,10,53,51],[73,11,53,52],[74,8,54,4],[76,8,56,4],[77,8,57,4],[77,12,57,10,"responseUrl"],[77,23,57,21],[77,26,57,24,"authResponse"],[77,38,57,36],[77,39,57,37,"url"],[77,42,57,40],[77,46,57,44],[77,48,57,46],[78,8,58,4],[78,12,58,8,"responseUrl"],[78,23,58,19],[78,24,58,20,"includes"],[78,32,58,28],[78,33,58,29],[78,41,58,37],[78,42,58,38],[78,44,58,40],[79,10,59,6],[79,14,59,12,"errorMatch"],[79,24,59,22],[79,27,59,25,"responseUrl"],[79,38,59,36],[79,39,59,37,"match"],[79,44,59,42],[79,45,59,43],[79,60,59,58],[79,61,59,59],[80,10,60,6],[80,14,60,12,"errorType"],[80,23,60,21],[80,26,60,24,"errorMatch"],[80,36,60,34],[80,39,60,37,"decodeURIComponent"],[80,57,60,55],[80,58,60,56,"errorMatch"],[80,68,60,66],[80,69,60,67],[80,70,60,68],[80,71,60,69],[80,72,60,70],[80,75,60,73],[80,94,60,92],[81,10,61,6,"console"],[81,17,61,13],[81,18,61,14,"log"],[81,21,61,17],[81,22,61,18],[81,68,61,64],[81,70,61,66,"errorType"],[81,79,61,75],[81,80,61,76],[82,10,62,2],[82,17,62,9],[83,12,62,11,"ok"],[83,14,62,13],[83,16,62,15],[83,21,62,20],[84,12,62,22,"error"],[84,17,62,27],[84,19,62,29],[85,10,62,51],[85,11,62,52],[86,8,63,4],[88,8,65,4],[89,8,66,4],[89,14,66,10],[89,18,66,14,"Promise"],[89,25,66,21],[89,26,66,22,"resolve"],[89,33,66,29],[89,37,66,33,"setTimeout"],[89,47,66,43],[89,48,66,44,"resolve"],[89,55,66,51],[89,57,66,53],[89,60,66,56],[89,61,66,57],[89,62,66,58],[91,8,68,4],[92,8,69,4,"console"],[92,15,69,11],[92,16,69,12,"log"],[92,19,69,15],[92,20,69,16],[92,65,69,61],[92,66,69,62],[93,8,70,4],[93,12,70,10,"session"],[93,19,70,17],[93,28,70,26],[93,32,70,26,"apiFetchJson"],[93,49,70,38],[93,51,70,39],[93,70,70,58],[93,72,70,60],[94,10,70,62,"method"],[94,16,70,68],[94,18,70,70],[95,8,70,76],[95,9,70,77],[95,10,70,78],[96,8,71,4,"console"],[96,15,71,11],[96,16,71,12,"log"],[96,19,71,15],[96,20,71,16],[96,64,71,60],[96,66,71,62,"JSON"],[96,70,71,66],[96,71,71,67,"stringify"],[96,80,71,76],[96,81,71,77,"session"],[96,88,71,84],[96,89,71,85],[96,90,71,86],[97,8,73,4],[97,12,73,8,"session"],[97,19,73,15],[97,24,73,20,"session"],[97,31,73,27],[97,32,73,28,"user"],[97,36,73,32],[97,40,73,36,"session"],[97,47,73,43],[97,49,73,45,"expires"],[97,56,73,52],[97,57,73,53],[97,59,73,55],[98,10,74,6],[99,10,75,6,"useAuthStore"],[99,29,75,18],[99,30,75,19,"getState"],[99,38,75,27],[99,39,75,28],[99,40,75,29],[99,41,75,30,"setAuth"],[99,48,75,37],[99,49,75,38,"session"],[99,56,75,45],[99,57,75,46],[100,10,76,6,"console"],[100,17,76,13],[100,18,76,14,"log"],[100,21,76,17],[100,22,76,18],[100,67,76,63],[100,68,76,64],[101,10,77,6],[101,17,77,13],[102,12,77,15,"ok"],[102,14,77,17],[102,16,77,19],[102,20,77,23],[103,12,77,25,"session"],[104,10,77,33],[104,11,77,34],[105,8,78,4],[106,8,80,4,"console"],[106,15,80,11],[106,16,80,12,"log"],[106,19,80,15],[106,20,80,16],[106,71,80,67],[106,72,80,68],[107,8,81,4],[107,15,81,11],[108,10,81,13,"ok"],[108,12,81,15],[108,14,81,17],[108,19,81,22],[109,10,81,24,"error"],[109,15,81,29],[109,17,81,31],[110,8,81,53],[110,9,81,54],[111,6,82,2],[111,7,82,3],[111,8,82,4],[111,15,82,11,"error"],[111,20,82,16],[111,22,82,18],[112,8,83,4,"console"],[112,15,83,11],[112,16,83,12,"error"],[112,21,83,17],[112,22,83,18],[112,69,83,65],[112,71,83,67,"error"],[112,76,83,72],[112,77,83,73],[113,8,84,4],[113,15,84,11],[114,10,84,13,"ok"],[114,12,84,15],[114,14,84,17],[114,19,84,22],[115,10,84,24,"error"],[115,15,84,29],[115,17,84,31,"error"],[115,22,84,36],[115,23,84,37,"message"],[115,30,84,44],[115,34,84,48],[116,8,84,65],[116,9,84,66],[117,6,85,2],[118,4,86,0],[118,5,86,1],[119,4,86,1],[119,11,86,1,"_signInWithCredentials"],[119,33,86,1],[119,34,86,1,"apply"],[119,39,86,1],[119,46,86,1,"arguments"],[119,55,86,1],[120,2,86,1],[121,2,86,1],[121,6,86,1,"_default"],[121,14,86,1],[121,17,86,1,"exports"],[121,24,86,1],[121,25,86,1,"default"],[121,32,86,1],[121,35,88,15,"signInWithCredentials"],[121,56,88,36],[122,0,88,36],[122,3]],"functionMap":{"names":["<global>","signInWithCredentials","authResponse.headers.forEach$argument_0","Promise$argument_0"],"mappings":"AAA;OCU;iCCkC;KDE;sBEmB,mCF;CDoB"}},"type":"js/module"}]}