{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"]}},{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"]}},{"name":"@/utils/api","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":63,"index":63}}],"key":"dzXjryHTvdSCDFGj8HDj8YCDHm4=","exportNames":["*"]}},{"name":"./store","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":65},"end":{"line":2,"column":39,"index":104}}],"key":"5APpJpQn7z9vMHIr4H9Bv6aaMsY=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.default = void 0;\n  exports.signInWithCredentials = signInWithCredentials;\n  var _asyncToGenerator2 = _interopRequireDefault(require(_dependencyMap[1], \"@babel/runtime/helpers/asyncToGenerator\"));\n  var _api = require(_dependencyMap[2], \"@/utils/api\");\n  var _store = require(_dependencyMap[3], \"./store\");\n  // Programmatic credentials sign-in for mobile clients\n  // 1) POST to /api/auth/callback/credentials with form-encoded body\n  // 2) Fetch /api/auth/session to retrieve the session payload\n  // 3) Persist session in auth store (SecureStore)\n  function signInWithCredentials(_x) {\n    return _signInWithCredentials.apply(this, arguments);\n  }\n  function _signInWithCredentials() {\n    _signInWithCredentials = (0, _asyncToGenerator2.default)(function* (_ref) {\n      var email = _ref.email,\n        password = _ref.password,\n        _ref$callbackUrl = _ref.callbackUrl,\n        callbackUrl = _ref$callbackUrl === void 0 ? '/' : _ref$callbackUrl;\n      try {\n        var body = new URLSearchParams();\n        body.set('email', email);\n        body.set('password', password);\n        // Provide a callbackUrl so Auth.js has a target (even if we don't follow it here)\n        if (callbackUrl) body.set('callbackUrl', callbackUrl);\n        console.log('[signInWithCredentials] Attempting to sign in with email:', email);\n\n        // Auth.js may respond with a redirect; RN fetch will still apply Set-Cookie\n        var authResponse = yield (0, _api.apiFetch)('/api/auth/callback/credentials', {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/x-www-form-urlencoded'\n          },\n          body: body.toString()\n        });\n        console.log('[signInWithCredentials] Auth callback response status:', authResponse.status);\n        console.log('[signInWithCredentials] Auth callback response URL:', authResponse.url);\n\n        // Log response headers to check if Set-Cookie was sent\n        var headers = {};\n        authResponse.headers.forEach((value, key) => {\n          headers[key] = value;\n        });\n        console.log('[signInWithCredentials] Response headers:', JSON.stringify(headers));\n\n        // Check if the response indicates an error\n        if (authResponse.status === 401 || authResponse.status === 403) {\n          console.log('[signInWithCredentials] Authentication failed - invalid credentials');\n          return {\n            ok: false,\n            error: 'Invalid email or password'\n          };\n        }\n\n        // Check if response contains an error parameter in URL (Auth.js error redirect)\n        var responseUrl = authResponse.url || '';\n        if (responseUrl.includes('error=')) {\n          var errorMatch = responseUrl.match(/error=([^&]+)/);\n          var errorType = errorMatch ? decodeURIComponent(errorMatch[1]) : 'CredentialsSignin';\n          console.log('[signInWithCredentials] Auth error detected:', errorType);\n          return {\n            ok: false,\n            error: 'Invalid email or password'\n          };\n        }\n\n        // Give the server a moment to set the session cookie\n        yield new Promise(resolve => setTimeout(resolve, 500));\n\n        // Now retrieve the session JSON\n        console.log('[signInWithCredentials] Fetching session...');\n        var session = yield (0, _api.apiFetchJson)('/api/auth/session', {\n          method: 'GET'\n        });\n        console.log('[signInWithCredentials] Session retrieved:', JSON.stringify(session));\n        if (session && (session.user || session?.expires)) {\n          // Store in auth store for app UI\n          _store.useAuthStore.getState().setAuth(session);\n          console.log('[signInWithCredentials] Sign in successful!');\n          return {\n            ok: true,\n            session\n          };\n        }\n        console.log('[signInWithCredentials] No valid session returned');\n        return {\n          ok: false,\n          error: 'No session returned'\n        };\n      } catch (error) {\n        console.error('[signInWithCredentials] Error during sign in:', error);\n        return {\n          ok: false,\n          error: error.message || 'Sign in failed'\n        };\n      }\n    });\n    return _signInWithCredentials.apply(this, arguments);\n  }\n  var _default = exports.default = signInWithCredentials;\n});","lineCount":105,"map":[[9,2,1,0],[9,6,1,0,"_api"],[9,10,1,0],[9,13,1,0,"require"],[9,20,1,0],[9,21,1,0,"_dependencyMap"],[9,35,1,0],[10,2,2,0],[10,6,2,0,"_store"],[10,12,2,0],[10,15,2,0,"require"],[10,22,2,0],[10,23,2,0,"_dependencyMap"],[10,37,2,0],[11,2,4,0],[12,2,5,0],[13,2,6,0],[14,2,7,0],[15,2,7,0],[15,11,8,22,"signInWithCredentials"],[15,32,8,43,"signInWithCredentials"],[15,33,8,43,"_x"],[15,35,8,43],[16,4,8,43],[16,11,8,43,"_signInWithCredentials"],[16,33,8,43],[16,34,8,43,"apply"],[16,39,8,43],[16,46,8,43,"arguments"],[16,55,8,43],[17,2,8,43],[18,2,8,43],[18,11,8,43,"_signInWithCredentials"],[18,34,8,43],[19,4,8,43,"_signInWithCredentials"],[19,26,8,43],[19,33,8,43,"_asyncToGenerator2"],[19,51,8,43],[19,52,8,43,"default"],[19,59,8,43],[19,61,8,7],[19,72,8,7,"_ref"],[19,76,8,7],[19,78,8,84],[20,6,8,84],[20,10,8,46,"email"],[20,15,8,51],[20,18,8,51,"_ref"],[20,22,8,51],[20,23,8,46,"email"],[20,28,8,51],[21,8,8,53,"password"],[21,16,8,61],[21,19,8,61,"_ref"],[21,23,8,61],[21,24,8,53,"password"],[21,32,8,61],[22,8,8,61,"_ref$callbackUrl"],[22,24,8,61],[22,27,8,61,"_ref"],[22,31,8,61],[22,32,8,63,"callbackUrl"],[22,43,8,74],[23,8,8,63,"callbackUrl"],[23,19,8,74],[23,22,8,74,"_ref$callbackUrl"],[23,38,8,74],[23,52,8,77],[23,55,8,80],[23,58,8,80,"_ref$callbackUrl"],[23,74,8,80],[24,6,9,2],[24,10,9,6],[25,8,10,4],[25,12,10,10,"body"],[25,16,10,14],[25,19,10,17],[25,23,10,21,"URLSearchParams"],[25,38,10,36],[25,39,10,37],[25,40,10,38],[26,8,11,4,"body"],[26,12,11,8],[26,13,11,9,"set"],[26,16,11,12],[26,17,11,13],[26,24,11,20],[26,26,11,22,"email"],[26,31,11,27],[26,32,11,28],[27,8,12,4,"body"],[27,12,12,8],[27,13,12,9,"set"],[27,16,12,12],[27,17,12,13],[27,27,12,23],[27,29,12,25,"password"],[27,37,12,33],[27,38,12,34],[28,8,13,4],[29,8,14,4],[29,12,14,8,"callbackUrl"],[29,23,14,19],[29,25,14,21,"body"],[29,29,14,25],[29,30,14,26,"set"],[29,33,14,29],[29,34,14,30],[29,47,14,43],[29,49,14,45,"callbackUrl"],[29,60,14,56],[29,61,14,57],[30,8,16,4,"console"],[30,15,16,11],[30,16,16,12,"log"],[30,19,16,15],[30,20,16,16],[30,79,16,75],[30,81,16,77,"email"],[30,86,16,82],[30,87,16,83],[32,8,18,4],[33,8,19,4],[33,12,19,10,"authResponse"],[33,24,19,22],[33,33,19,31],[33,37,19,31,"apiFetch"],[33,50,19,39],[33,52,19,40],[33,84,19,72],[33,86,19,74],[34,10,20,6,"method"],[34,16,20,12],[34,18,20,14],[34,24,20,20],[35,10,21,6,"headers"],[35,17,21,13],[35,19,21,15],[36,12,21,17],[36,26,21,31],[36,28,21,33],[37,10,21,69],[37,11,21,70],[38,10,22,6,"body"],[38,14,22,10],[38,16,22,12,"body"],[38,20,22,16],[38,21,22,17,"toString"],[38,29,22,25],[38,30,22,26],[39,8,23,4],[39,9,23,5],[39,10,23,6],[40,8,25,4,"console"],[40,15,25,11],[40,16,25,12,"log"],[40,19,25,15],[40,20,25,16],[40,76,25,72],[40,78,25,74,"authResponse"],[40,90,25,86],[40,91,25,87,"status"],[40,97,25,93],[40,98,25,94],[41,8,26,4,"console"],[41,15,26,11],[41,16,26,12,"log"],[41,19,26,15],[41,20,26,16],[41,73,26,69],[41,75,26,71,"authResponse"],[41,87,26,83],[41,88,26,84,"url"],[41,91,26,87],[41,92,26,88],[43,8,28,4],[44,8,29,4],[44,12,29,10,"headers"],[44,19,29,17],[44,22,29,20],[44,23,29,21],[44,24,29,22],[45,8,30,4,"authResponse"],[45,20,30,16],[45,21,30,17,"headers"],[45,28,30,24],[45,29,30,25,"forEach"],[45,36,30,32],[45,37,30,33],[45,38,30,34,"value"],[45,43,30,39],[45,45,30,41,"key"],[45,48,30,44],[45,53,30,49],[46,10,31,6,"headers"],[46,17,31,13],[46,18,31,14,"key"],[46,21,31,17],[46,22,31,18],[46,25,31,21,"value"],[46,30,31,26],[47,8,32,4],[47,9,32,5],[47,10,32,6],[48,8,33,4,"console"],[48,15,33,11],[48,16,33,12,"log"],[48,19,33,15],[48,20,33,16],[48,63,33,59],[48,65,33,61,"JSON"],[48,69,33,65],[48,70,33,66,"stringify"],[48,79,33,75],[48,80,33,76,"headers"],[48,87,33,83],[48,88,33,84],[48,89,33,85],[50,8,35,4],[51,8,36,4],[51,12,36,8,"authResponse"],[51,24,36,20],[51,25,36,21,"status"],[51,31,36,27],[51,36,36,32],[51,39,36,35],[51,43,36,39,"authResponse"],[51,55,36,51],[51,56,36,52,"status"],[51,62,36,58],[51,67,36,63],[51,70,36,66],[51,72,36,68],[52,10,37,6,"console"],[52,17,37,13],[52,18,37,14,"log"],[52,21,37,17],[52,22,37,18],[52,91,37,87],[52,92,37,88],[53,10,38,6],[53,17,38,13],[54,12,38,15,"ok"],[54,14,38,17],[54,16,38,19],[54,21,38,24],[55,12,38,26,"error"],[55,17,38,31],[55,19,38,33],[56,10,38,61],[56,11,38,62],[57,8,39,4],[59,8,41,4],[60,8,42,4],[60,12,42,10,"responseUrl"],[60,23,42,21],[60,26,42,24,"authResponse"],[60,38,42,36],[60,39,42,37,"url"],[60,42,42,40],[60,46,42,44],[60,48,42,46],[61,8,43,4],[61,12,43,8,"responseUrl"],[61,23,43,19],[61,24,43,20,"includes"],[61,32,43,28],[61,33,43,29],[61,41,43,37],[61,42,43,38],[61,44,43,40],[62,10,44,6],[62,14,44,12,"errorMatch"],[62,24,44,22],[62,27,44,25,"responseUrl"],[62,38,44,36],[62,39,44,37,"match"],[62,44,44,42],[62,45,44,43],[62,60,44,58],[62,61,44,59],[63,10,45,6],[63,14,45,12,"errorType"],[63,23,45,21],[63,26,45,24,"errorMatch"],[63,36,45,34],[63,39,45,37,"decodeURIComponent"],[63,57,45,55],[63,58,45,56,"errorMatch"],[63,68,45,66],[63,69,45,67],[63,70,45,68],[63,71,45,69],[63,72,45,70],[63,75,45,73],[63,94,45,92],[64,10,46,6,"console"],[64,17,46,13],[64,18,46,14,"log"],[64,21,46,17],[64,22,46,18],[64,68,46,64],[64,70,46,66,"errorType"],[64,79,46,75],[64,80,46,76],[65,10,47,6],[65,17,47,13],[66,12,47,15,"ok"],[66,14,47,17],[66,16,47,19],[66,21,47,24],[67,12,47,26,"error"],[67,17,47,31],[67,19,47,33],[68,10,47,61],[68,11,47,62],[69,8,48,4],[71,8,50,4],[72,8,51,4],[72,14,51,10],[72,18,51,14,"Promise"],[72,25,51,21],[72,26,51,22,"resolve"],[72,33,51,29],[72,37,51,33,"setTimeout"],[72,47,51,43],[72,48,51,44,"resolve"],[72,55,51,51],[72,57,51,53],[72,60,51,56],[72,61,51,57],[72,62,51,58],[74,8,53,4],[75,8,54,4,"console"],[75,15,54,11],[75,16,54,12,"log"],[75,19,54,15],[75,20,54,16],[75,65,54,61],[75,66,54,62],[76,8,55,4],[76,12,55,10,"session"],[76,19,55,17],[76,28,55,26],[76,32,55,26,"apiFetchJson"],[76,49,55,38],[76,51,55,39],[76,70,55,58],[76,72,55,60],[77,10,55,62,"method"],[77,16,55,68],[77,18,55,70],[78,8,55,76],[78,9,55,77],[78,10,55,78],[79,8,56,4,"console"],[79,15,56,11],[79,16,56,12,"log"],[79,19,56,15],[79,20,56,16],[79,64,56,60],[79,66,56,62,"JSON"],[79,70,56,66],[79,71,56,67,"stringify"],[79,80,56,76],[79,81,56,77,"session"],[79,88,56,84],[79,89,56,85],[79,90,56,86],[80,8,58,4],[80,12,58,8,"session"],[80,19,58,15],[80,24,58,20,"session"],[80,31,58,27],[80,32,58,28,"user"],[80,36,58,32],[80,40,58,36,"session"],[80,47,58,43],[80,49,58,45,"expires"],[80,56,58,52],[80,57,58,53],[80,59,58,55],[81,10,59,6],[82,10,60,6,"useAuthStore"],[82,29,60,18],[82,30,60,19,"getState"],[82,38,60,27],[82,39,60,28],[82,40,60,29],[82,41,60,30,"setAuth"],[82,48,60,37],[82,49,60,38,"session"],[82,56,60,45],[82,57,60,46],[83,10,61,6,"console"],[83,17,61,13],[83,18,61,14,"log"],[83,21,61,17],[83,22,61,18],[83,67,61,63],[83,68,61,64],[84,10,62,6],[84,17,62,13],[85,12,62,15,"ok"],[85,14,62,17],[85,16,62,19],[85,20,62,23],[86,12,62,25,"session"],[87,10,62,33],[87,11,62,34],[88,8,63,4],[89,8,65,4,"console"],[89,15,65,11],[89,16,65,12,"log"],[89,19,65,15],[89,20,65,16],[89,71,65,67],[89,72,65,68],[90,8,66,4],[90,15,66,11],[91,10,66,13,"ok"],[91,12,66,15],[91,14,66,17],[91,19,66,22],[92,10,66,24,"error"],[92,15,66,29],[92,17,66,31],[93,8,66,53],[93,9,66,54],[94,6,67,2],[94,7,67,3],[94,8,67,4],[94,15,67,11,"error"],[94,20,67,16],[94,22,67,18],[95,8,68,4,"console"],[95,15,68,11],[95,16,68,12,"error"],[95,21,68,17],[95,22,68,18],[95,69,68,65],[95,71,68,67,"error"],[95,76,68,72],[95,77,68,73],[96,8,69,4],[96,15,69,11],[97,10,69,13,"ok"],[97,12,69,15],[97,14,69,17],[97,19,69,22],[98,10,69,24,"error"],[98,15,69,29],[98,17,69,31,"error"],[98,22,69,36],[98,23,69,37,"message"],[98,30,69,44],[98,34,69,48],[99,8,69,65],[99,9,69,66],[100,6,70,2],[101,4,71,0],[101,5,71,1],[102,4,71,1],[102,11,71,1,"_signInWithCredentials"],[102,33,71,1],[102,34,71,1,"apply"],[102,39,71,1],[102,46,71,1,"arguments"],[102,55,71,1],[103,2,71,1],[104,2,71,1],[104,6,71,1,"_default"],[104,14,71,1],[104,17,71,1,"exports"],[104,24,71,1],[104,25,71,1,"default"],[104,32,71,1],[104,35,73,15,"signInWithCredentials"],[104,56,73,36],[105,0,73,36],[105,3]],"functionMap":{"names":["<global>","signInWithCredentials","authResponse.headers.forEach$argument_0","Promise$argument_0"],"mappings":"AAA;OCO;iCCsB;KDE;sBEmB,mCF;CDoB"}},"type":"js/module"}]}